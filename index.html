<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aplikasi Pembelajaran Mepsi</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom styles for the application */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f5f5dc; /* Light cream background */
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px; /* Add some padding for smaller screens */
            box-sizing: border-box;
        }

        .app-container {
            background-color: #ffffff;
            border: 4px solid #000;
            border-radius: 20px;
            box-shadow: 8px 8px 0px #000;
            width: 100%;
            max-width: 800px; /* Max width for desktop view */
            height: 90vh; /* Responsive height */
            max-height: 700px; /* Max height for desktop view */
            display: flex;
            flex-direction: column;
            overflow: hidden; /* Hide overflow for content */
            position: relative;
        }

        .header-bar {
            background-color: #ffb74d; /* Orange from storyboard */
            border-bottom: 2px solid #000;
            padding: 10px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-weight: bold;
            font-size: 1.1rem;
            color: #000;
            position: relative;
            z-index: 10; /* Ensure header is above content */
        }

        .header-icons {
            display: flex;
            gap: 15px;
        }

        .header-icon {
            cursor: pointer;
            width: 28px;
            height: 28px;
            color: #000;
            transition: transform 0.2s;
        }

        .header-icon:hover {
            transform: scale(1.1);
        }

        .main-content {
            flex-grow: 1;
            padding: 20px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            overflow-y: auto; /* Enable scrolling for content */
            -ms-overflow-style: none;  /* IE and Edge */
            scrollbar-width: none;  /* Firefox */
        }

        .main-content::-webkit-scrollbar {
            display: none; /* Chrome, Safari, Opera */
        }

        .button {
            background-color: #ffb74d; /* Orange from storyboard */
            border: 2px solid #000;
            border-radius: 10px;
            padding: 12px 25px;
            font-size: 1.2rem;
            font-weight: bold;
            color: #000;
            cursor: pointer;
            box-shadow: 4px 4px 0px #000;
            transition: all 0.1s ease-in-out;
            width: 100%;
            max-width: 300px;
        }

        .button:hover {
            transform: translate(2px, 2px);
            box-shadow: 2px 2px 0px #000;
        }

        .button:active {
            transform: translate(4px, 4px);
            box-shadow: 0px 0px 0px #000;
        }

        .nav-button {
            background-color: #87ceeb; /* Light blue from flowchart */
            border: 2px solid #000;
            border-radius: 10px;
            padding: 10px 20px;
            font-size: 1.1rem;
            font-weight: bold;
            color: #000;
            cursor: pointer;
            box-shadow: 3px 3px 0px #000;
            transition: all 0.1s ease-in-out;
        }

        .nav-button:hover {
            transform: translate(1px, 1px);
            box-shadow: 1px 1px 0px #000;
        }

        .nav-button:active {
            transform: translate(2px, 2px);
            box-shadow: 0px 0px 0px #000;
        }

        .icon-button {
            background: none;
            border: none;
            cursor: pointer;
            padding: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #000;
        }

        .icon-button svg {
            width: 30px;
            height: 30px;
        }

        .icon-button.red-bg {
            background-color: #ff4d4d; /* Red for exit icon */
            border-radius: 50%;
            padding: 5px;
            box-shadow: 2px 2px 0px #000;
        }

        .icon-button.red-bg svg {
            color: #fff;
        }

        .icon-button.red-bg:hover {
            transform: scale(1.05);
        }

        .icon-button.red-bg:active {
            transform: scale(0.95);
        }

        /* Specific screen styles */
        #start-screen .title-box {
            background-color: #ffb74d;
            border: 2px solid #000;
            border-radius: 10px;
            padding: 30px 20px;
            margin-bottom: 50px;
            box-shadow: 6px 6px 0px #000;
            max-width: 500px;
            width: 90%;
        }

        #start-screen .title-box h1 {
            font-size: 1.8rem;
            margin-bottom: 10px;
            line-height: 1.3;
        }

        #start-screen .title-box p {
            font-size: 1.2rem;
            font-weight: normal;
        }

        #menu-screen .menu-buttons {
            display: flex;
            flex-direction: column;
            gap: 20px;
            width: 100%;
            max-width: 300px;
        }

        #menu-screen .illustration {
            position: absolute;
            right: 20px;
            bottom: 20px;
            width: 250px; /* Adjust size as needed */
            height: auto;
            z-index: 0; /* Behind buttons */
            opacity: 0.7;
        }

        @media (max-width: 768px) {
            #menu-screen .illustration {
                display: none; /* Hide illustration on smaller screens */
            }
        }

        #petunjuk-screen .instruction-item {
            display: flex;
            align-items: center;
            gap: 15px;
            background-color: #ffb74d;
            border: 2px solid #000;
            border-radius: 10px;
            padding: 10px 20px;
            margin-bottom: 15px;
            box-shadow: 4px 4px 0px #000;
            width: 100%;
            max-width: 500px;
            text-align: left;
        }

        #petunjuk-screen .instruction-item svg {
            width: 35px;
            height: 35px;
            flex-shrink: 0;
        }

        #petunjuk-screen .instruction-item .icon-red-bg {
            background-color: #ff4d4d;
            border-radius: 50%;
            padding: 5px;
            box-shadow: 2px 2px 0px #000;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        #petunjuk-screen .instruction-item .icon-red-bg svg {
            color: #fff;
        }

        #cp-tp-screen .content-box {
            background-color: #ffb74d;
            border: 2px solid #000;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 6px 6px 0px #000;
            width: 100%;
            max-width: 600px;
            text-align: left;
            margin-bottom: 20px;
        }

        #cp-tp-screen .content-box h3 {
            font-size: 1.3rem;
            margin-bottom: 10px;
            text-align: center;
        }

        #cp-tp-screen .content-box ul {
            list-style-type: disc;
            margin-left: 20px;
        }

        #cp-tp-screen .nav-arrows {
            display: flex;
            justify-content: space-between;
            width: 100%;
            max-width: 600px;
        }

        #materi-screen .materi-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 20px;
            width: 100%;
            max-width: 600px;
            margin-bottom: 20px;
        }

        #materi-screen .materi-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
        }

        #materi-screen .materi-item img {
            width: 100px;
            height: 100px;
            object-fit: contain;
            border: 2px solid #000;
            border-radius: 10px;
            box-shadow: 3px 3px 0px #000;
        }

        #materi-screen .materi-item .button {
            width: 100%;
            max-width: none; /* Override max-width for grid */
        }

        #materi-detail-screen .story-content {
            background-color: #ffb74d;
            border: 2px solid #000;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 6px 6px 0px #000;
            width: 100%;
            max-width: 600px;
            text-align: left;
            margin-bottom: 20px;
            overflow-y: auto;
            max-height: 400px; /* Limit height for scrollable content */
        }

        #materi-detail-screen .story-content h3 {
            font-size: 1.3rem;
            margin-bottom: 10px;
            text-align: center;
        }

        #materi-detail-screen .story-content p,
        #materi-detail-screen .story-content ul {
            margin-bottom: 10px;
        }

        #latihan-screen .question-box {
            background-color: #ffb74d;
            border: 2px solid #000;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 6px 6px 0px #000;
            width: 100%;
            max-width: 600px;
            text-align: left;
            margin-bottom: 20px;
        }

        #latihan-screen .question-box p {
            font-size: 1.1rem;
            margin-bottom: 15px;
            font-weight: bold;
        }

        #latihan-screen .options-grid {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        #latihan-screen .option-button {
            background-color: #ffffff;
            border: 2px solid #000;
            border-radius: 8px;
            padding: 10px 15px;
            text-align: left;
            cursor: pointer;
            font-size: 1rem;
            box-shadow: 2px 2px 0px #000;
            transition: all 0.1s ease-in-out;
        }

        #latihan-screen .option-button:hover {
            transform: translate(1px, 1px);
            box-shadow: 1px 1px 0px #000;
        }

        #latihan-screen .option-button.correct {
            background-color: #a8e6cf; /* Light green for correct */
        }

        #latihan-screen .option-button.incorrect {
            background-color: #ff8a80; /* Light red for incorrect */
        }

        #latihan-screen .feedback-message {
            margin-top: 15px;
            font-weight: bold;
            font-size: 1.1rem;
        }

        #latihan-screen .score-box {
            background-color: #87ceeb;
            border: 2px solid #000;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 6px 6px 0px #000;
            width: 100%;
            max-width: 400px;
            margin-top: 20px;
        }

        #profil-screen .profile-content {
            background-color: #ffb74d;
            border: 2px solid #000;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 6px 6px 0px #000;
            width: 100%;
            max-width: 500px;
            text-align: left;
            margin-bottom: 20px;
        }

        /* Modal for alerts/confirmations */
        .modal-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 100;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease-in-out, visibility 0.3s ease-in-out;
        }

        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .modal-content {
            background-color: #ffffff;
            border: 3px solid #000;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 6px 6px 0px #000;
            text-align: center;
            max-width: 400px;
            width: 90%;
            transform: translateY(-20px);
            transition: transform 0.3s ease-in-out;
        }

        .modal-overlay.active .modal-content {
            transform: translateY(0);
        }

        .modal-content h3 {
            font-size: 1.5rem;
            margin-bottom: 20px;
            color: #000;
        }

        .modal-content .modal-buttons {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 20px;
        }

        .modal-content .modal-button {
            padding: 10px 20px;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            border: 2px solid #000;
            box-shadow: 3px 3px 0px #000;
            transition: all 0.1s ease-in-out;
        }

        .modal-content .modal-button:hover {
            transform: translate(1px, 1px);
            box-shadow: 1px 1px 0px #000;
        }

        .modal-content .modal-button.confirm {
            background-color: #ff4d4d; /* Red for confirm/exit */
            color: #fff;
        }

        .modal-content .modal-button.cancel {
            background-color: #ffb74d; /* Orange for cancel */
            color: #000;
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Header Bar -->
        <div class="header-bar" id="app-header">
            <span id="app-title">Cerita Rakyat Jawa Tengah</span>
            <div class="header-icons">
                <button class="icon-button" id="home-button" aria-label="Beranda">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/>
                    </svg>
                </button>
                <button class="icon-button" id="sound-button" aria-label="Kontrol Suara">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                        <path id="sound-icon-path" d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"/>
                    </svg>
                </button>
                <button class="icon-button red-bg" id="exit-button" aria-label="Keluar">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
                    </svg>
                </button>
            </div>
        </div>

        <!-- Main Content Area -->
        <div class="main-content" id="app-content">
            <!-- Tambahkan elemen audio -->
            <audio id="background-audio" src="audio/ukulele.mp3" preload="auto" loop></audio>
            <!-- Screens will be dynamically loaded here -->

            <!-- Start Screen -->
            <div id="start-screen" class="screen">
                <div class="title-box">
                    <h1>Media Pembelajaran Bahasa Indonesia</h1>
                    <h1>Unsur-Unsur Dalam Cerita</h1>
                    <p>Cerita Rakyat Jawa Tengah</p>
                </div>
                <button class="button" id="start-app-button">Start</button>
            </div>

            <!-- Menu Screen -->
            <div id="menu-screen" class="screen hidden">
                <div class="menu-buttons">
                    <button class="button" id="btn-petunjuk">Petunjuk</button>
                    <button class="button" id="btn-cp-tp">CP Dan TP</button>
                    <button class="button" id="btn-materi">Materi</button>
                    <button class="button" id="btn-latihan">Latihan</button>
                    <button class="button" id="btn-profil">Profil</button>
                </div>
                <!-- Illustration from storyboard (can be SVG or image) -->
                <img src="img/wayang.png" alt="Ilustrasi Wayang" class="illustration">
            </div>

            <!-- Petunjuk Screen -->
            <div id="petunjuk-screen" class="screen hidden">
                <h2 class="text-2xl font-bold mb-8">Petunjuk</h2>
                <div class="instruction-item">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M6 18l8.5-6L6 6v12zm9-12v12h2V6h-2z"/>
                    </svg>
                    <span>Tombol untuk melanjutkan</span>
                </div>
                <div class="instruction-item">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M18 18V6l-8.5 6 8.5 6zM6 6h2v12H6z"/>
                    </svg>
                    <span>Tombol untuk kembali</span>
                </div>
                <div class="instruction-item">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"/>
                    </svg>
                    <span>Tombol suara</span>
                </div>
                <div class="instruction-item">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/>
                    </svg>
                    <span>Tombol untuk ke menu utama</span>
                </div>
                <div class="instruction-item">
                    <span class="icon-red-bg">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
                        </svg>
                    </span>
                    <span>Tombol untuk keluar</span>
                </div>
                <div class="nav-arrows mt-8">
                    <button class="nav-button" id="petunjuk-back-button">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="24" height="24">
                            <path d="M18 18V6l-8.5 6 8.5 6zM6 6h2v12H6z"/>
                        </svg>
                    </button>
                    <button class="nav-button" id="petunjuk-next-button">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="24" height="24">
                            <path d="M6 18l8.5-6L6 6v12zm9-12v12h2V6h-2z"/>
                        </svg>
                    </button>
                </div>
            </div>

            <!-- CP Dan TP Screen -->
            <div id="cp-tp-screen" class="screen hidden">
                <h2 class="text-2xl font-bold mb-8">CP Dan TP</h2>
                <div class="content-box">
                    <h3>Capaian Pembelajaran :</h3>
                    <ul class="list-disc ml-5">
                        <li>Menyimak</li>
                        <li>Membaca</li>
                        <li>Menulis</li>
                        <li>Berbicara</li>
                    </ul>
                    <h3 class="mt-5">Tujuan Pembelajaran :</h3>
                    <ul class="list-decimal ml-5">
                        <li>Melalui kegiatan berbicara dengan volume dan konteks yang tepat dan jelas, peserta didik membaca cerita atau bacaan dengan intonasi yang tepat.</li>
                        <li>Melalui kegiatan membaca dan menyimak, peserta didik dapat memahami unsur-unsur intrinsik suatu cerita.</li>
                        <li>Melalui kegiatan menulis, peserta didik dapat menuliskan unsur-unsur intrinsik satu cerita.</li>
                        <li>Melalui kegiatan berbicara, peserta didik dapat mempresentasikan unsur-unsur cerita didepan kelas dengan tepat sehingga dapat menarik pendengarnya.</li>
                    </ul>
                </div>
                <div class="nav-arrows">
                    <button class="nav-button" id="cp-tp-back-button">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="24" height="24">
                            <path d="M18 18V6l-8.5 6 8.5 6zM6 6h2v12H6z"/>
                        </svg>
                    </button>
                    <button class="nav-button" id="cp-tp-next-button">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="24" height="24">
                            <path d="M6 18l8.5-6L6 6v12zm9-12v12h2V6h-2z"/>
                        </svg>
                    </button>
                </div>
            </div>

            <!-- Materi Screen (Pilihan Cerita) -->
            <div id="materi-screen" class="screen hidden">
                <h2 class="text-2xl font-bold mb-8">Materi</h2>
                <div class="materi-grid">
                    <div class="materi-item">
                        <img src="img/lawangsewu.jpeg" alt="Asal usul Semarang">
                        <button class="button" data-story="semarang">Asal usul Semarang</button>
                    </div>
                    <div class="materi-item">
                        <img src="img/candi.jpeg" alt="Candi Prambanan">
                        <button class="button" data-story="prambanan">Candi Prambanan</button>
                    </div>
                    <div class="materi-item">
                        <img src="img/rawa.jpeg" alt="Rawa Pening">
                        <button class="button" data-story="rawa-pening">Rawa Pening</button>
                    </div>
                </div>
                <div class="nav-arrows">
                    <button class="nav-button" id="materi-back-button">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="24" height="24">
                            <path d="M18 18V6l-8.5 6 8.5 6zM6 6h2v12H6z"/>
                        </svg>
                    </button>
                    <button class="nav-button" id="materi-next-button">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="24" height="24">
                            <path d="M6 18l8.5-6L6 6v12zm9-12v12h2V6h-2z"/>
                        </svg>
                    </button>
                </div>
            </div>

            <!-- Materi Detail Screen (for each story) -->
            <div id="materi-detail-screen" class="screen hidden">
                <h2 class="text-2xl font-bold mb-8" id="materi-detail-title"></h2>
                <div class="story-content">
                    <div id="story-text"></div>
                    <h3 class="mt-4">Tema:</h3>
                    <p id="story-theme"></p>
                    <h3 class="mt-4">Amanat:</h3>
                    <p id="story-amanat"></p>
                    <h3 class="mt-4">Unsur Intrinsik:</h3>
                    <ul id="story-intrinsik" class="list-disc ml-5"></ul>
                </div>
                <div class="nav-arrows">
                    <button class="nav-button" id="materi-detail-back-button">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="24" height="24">
                            <path d="M18 18V6l-8.5 6 8.5 6zM6 6h2v12H6z"/>
                        </svg>
                    </button>
                    <button class="nav-button" id="materi-detail-next-button">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="24" height="24">
                            <path d="M6 18l8.5-6L6 6v12zm9-12v12h2V6h-2z"/>
                        </svg>
                    </button>
                </div>
            </div>

            <!-- Latihan Soal Screen -->
            <div id="latihan-screen" class="screen hidden">
                <h2 class="text-2xl font-bold mb-8">Latihan Soal</h2>
                <div class="question-box">
                    <p id="question-text"></p>
                    <div id="options-container" class="options-grid">
                        <!-- Options will be loaded here -->
                    </div>
                    <div id="feedback-message" class="feedback-message hidden"></div>
                </div>
                <div class="nav-arrows mt-8">
                    <button class="nav-button" id="latihan-back-button">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="24" height="24">
                            <path d="M18 18V6l-8.5 6 8.5 6zM6 6h2v12H6z"/>
                        </svg>
                    </button>
                    <button class="nav-button" id="latihan-next-button">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="24" height="24">
                            <path d="M6 18l8.5-6L6 6v12zm9-12v12h2V6h-2z"/>
                        </svg>
                    </button>
                </div>
                <div id="score-screen" class="score-box hidden">
                    <h3 class="text-xl font-bold mb-4">Hasil Latihan</h3>
                    <p class="text-lg">Skor Anda: <span id="final-score" class="font-bold">0</span> dari <span id="total-questions" class="font-bold">0</span></p>
                    <button class="button mt-4" id="retake-quiz-button">Ulangi Latihan</button>
                    <button class="button mt-4" id="back-to-menu-from-quiz-button">Kembali ke Menu</button>
                </div>
            </div>

            <!-- Profil Screen -->
            <div id="profil-screen" class="screen hidden">
                <h2 class="text-2xl font-bold mb-8">Profil</h2>
                <div class="profile-content">
                   <div style="display: flex; justify-content: center;">
                     <img src="img/sofia.jpeg" alt="Foto Profil" width="100px" height="100px" >
                     </div>
                    <h3>Biodata Pembuat:</h3>
                    <p>Nama: Sofia Rochmania</p>
                    <p>NIM: 21106051043</p>
                    <p>Peran: Pengembang Aplikasi Mepsi</p>
                    <p>Email: rochmaniasofia@gmail.com </p>
                    <p>Aplikasi ini dibuat sebagai media pembelajaran interaktif untuk memahami unsur-unsur dalam cerita rakyat Jawa Tengah.</p>
                </div>
                <div class="nav-arrows">
                    <button class="nav-button" id="profil-back-button">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="24" height="24">
                            <path d="M18 18V6l-8.5 6 8.5 6zM6 6h2v12H6z"/>
                        </svg>
                    </button>
                    <button class="nav-button" id="profil-next-button">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="24" height="24">
                            <path d="M6 18l8.5-6L6 6v12zm9-12v12h2V6h-2z"/>
                        </svg>
                    </button>
                </div>
            </div>

            <!-- Exit Screen (simulated) -->
            <div id="exit-screen" class="screen hidden">
                <h2 class="text-3xl font-bold mb-8">Terima Kasih!</h2>
                <p class="text-lg">Anda telah keluar dari aplikasi.</p>
                <button class="button mt-8" id="restart-app-button">Mulai Ulang Aplikasi</button>
            </div>

        </div>

        <!-- Custom Modal for Alerts/Confirmations -->
        <div id="custom-modal" class="modal-overlay">
            <div class="modal-content">
                <h3 id="modal-title"></h3>
                <p id="modal-message"></p>
                <div class="modal-buttons">
                    <button class="modal-button confirm" id="modal-confirm-btn">OK</button>
                    <button class="modal-button cancel hidden" id="modal-cancel-btn">Batal</button>
                </div>
            </div>
        </div>

    </div>

    <script>
        // Data for the application
        const stories = {
            "semarang": {
                title: "Asal usul Semarang",
                text: `Pada zaman dahulu di kerajaan Demak hidup seorang pangeran. Namanya Raden Made Pandan. Disamping sebagai bangsawan kerajaan ia juga dikenal sebagai seorang ulama atau ahli agama Islam yang cukup disegani berbagai kalangan masyarakat. Dia mempunyai seorang putra bernama Raden Pandanarang. Raden Pandanarang dikenal sebagai anak yang baik, sopansantun, ramah dan hormat kepada kedua orang tuanya. Pada suatu hari Raden Made Pandan mengajak puteranya dan beberapa pengiring pergi dari wilayah kesultanan Demak. Setelah beberapa hari, sampailah mereka di tempat yang subur. Di sana mereka mendirikan rumah. Raden Made Pandan juga mendirikan pondok pesantren dan mengajarkan agama Islam ditempat itu. Pada suatu hari Raden Made merasa bila akan menghadap Allah, maka ia berwasiat kepada putranya. “anakku, jika aku mati, teruskanlah perjuangan kita menyebarkan agama islam. jangan sekali-kali kau tinggalkan daerah ini. berpegang teguhlah kepada ajaran para wali. insyallah kelak hidup mu menjadi mulia, selamat dunia akhirat.” Pesan itu selalu terngiang di teliga Raden Pandanarang. Setelah ayahnya meninggal dunia, ia terus melanjutkan perjuangannya mengajarkan agama islam. Pada suatu hari ketika menggarap sawah Raden Pandanarang dan pengikutnya melihat suatu keanehan. Di atas tanah yang subur disela-sela pepohonan yang hijau nampak beberapa pohon asam tumbuh saling berjauhan atau jarang-jarang. Semua orang merasa heran melihat jarak antara pohon asam yang satu dengan yang lainnya. Raden Pandanarang berkata,”mengapa pohon asam itu tumbuh berjauhan, padahal tanah di sini subur. Mestinya pohon-pohon asam itu tumbuh berdekatan. “ benar raden…..!” sahut beberapa orang pengikutnya. “memang ini hal yang tak lazim terjadi, sangat aneh.” Raden Pandanarang berkata lagi.” kalau begitu daerah ini ku namakan semarang yaitu dari kata asem yang jarang.”`,
                theme: "Perkembangan dan transformasi suatu daerah dari awalnya yang masih alami menjadi sebuah kota yang penting dan ramai.",
                amanat: "Keberanian, persatuan, dan pentingnya menjaga lingkungan.",
                intrinsik: ["Tokoh", "Latar Tempat", "Watak", "Alur", "Latar Suasana", "Latar Waktu"]
            },
            "prambanan": {
                title: "Candi Prambanan",
                text: `Dahulu kala, di Desa Prambanan, ada sebuah kerajaan yang dipimpin oleh Prabu Baka. Ia memiliki seorang putri yang sangat cantik bernama Roro Jonggrang. Suatu ketika, Prambanan dikalahkan oleh Kerajaan Pengging yang dipimpin oleh Bandung Bondowoso. Prabu Baka tewas di medan perang. Dia terbunuh oleh Bandung Bondowoso yang sangat sakti. Bandung Bondowoso kemudian menempati Istana Prambanan. Melihat putri dari Prabu Baka yang cantik jelita yaitu Roro Jonggrang, timbul keinginannya untuk memperistri Roro Jonggrang. Roro Jonggrang tahu bahwa Bandung Bondowoso adalah orang yang membunuh ayahnya. Karena itu, ia mencari akal untuk menolaknya. Lalu, ia mengajukan syarat dibuatkan 1.000 buah candi dan dua buah sumur yang dalam. Semuanya harus selesai dalam semalam. Bandung Bondowoso menyanggupi persyaratan Roro Jonggrang. Ia meminta pertolongan kepada ayahnya dan mengerahkan balatentara roh-roh halus untuk membantunya pada hari yang ditentukan. Pukul empat pagi, hanya tinggal lima buah candi yang belum selesai dan kedua sumur hampir selesai. Mengetahui 1.000 candi telah hampir selesai, Roro Jonggrang ketakutan. “Apa yang harus kulakukan untuk menghentikannya?” pikirnya cemas membayangkan ia harus menerima pinangan Bandung Bondowoso yang telah membunuh orangtuanya. Akhirnya, ia pergi membangunkan gadis-gadis di Desa Prambanan dan memerintahkan untuk menghidupkan obor-obor dan membakar jerami, memukulkan alu pada lesung, dan menaburkan bunga-bunga yang harum. Suasana saat itu menjadi terang dan riuh. Semburat merah memancar di langit dengan seketika. Ayam jantan pun berkokok bersahut-sahutan. Mendengar suara itu, para roh halus segera meninggalkan pekerjaan. Mereka menyangka hari telah pagi dan matahari akan segera terbit. Pada saat itu hanya tinggal satu sebuah candi yang belum dibuat. Bandung Bondowoso sangat terkejut dan marah menyadari usahanya telah gagal. Dalam amarahnya, Bandung Bondowoso mengutuk Roro Jonggrang menjadi sebuah arca untuk melengkapi sebuah buah candi yang belum selesai. Batu arca Roro Jonggrang diletakkan di dalam ruang candi yang besar. Hingga kini, candi tersebut disebut dengan Candi Roro Jonggrang. Sementara itu, candi-candi di sekitarnya disebut dengan Candi Sewu (Candi Seribu) meskipun jumlahnya belum mencapai 1.000.`,
                theme: "Pengorbanan dan kebenaran melawan kejahatan.",
                amanat: "Pentingnya kejujuran, memenuhi janji, dan jangan menjadi orang yang serakah atau kejam.",
                intrinsik: ["Tokoh", "Latar Tempat", "Watak", "Alur", "Latar Suasana", "Latar Waktu"]
            },
            "rawa-pening": {
                title: "Rawa Pening",
                text: `Pada zaman dahulu, hiduplah seorang anak yang sakti. Kesaktiannya ini membuat seorang menyihir jahat iri. Penyihir jahat menyihir anak itu, sehingga tubuhnya penuh luka dengan bau yang sangat menyengat. Luka-luka baru akan muncul begitu luka lama mulai kering. Keadaannya kondisi tubuhnya itu, tidak ada seorang pun yang mau berhubungan dengannya. Jangankan bertegur sapa, berdekatan saja orang tidak mau. Mereka takut tertular. Suatu hari, anak ini bermimpi ada seorang perempuan tua yang dapat menyembuhkan penyakitnya. Ia pun berkelana mencari perempuan tua dalam mimpinya tersebut. Di setiap kampung yang ia datangi, ia selalu ditolak oleh penduduk. Mereka merasa jijik dan mengusir anak ini. Akhirnya, sampailah ia di sebuah kampung yang sebagian besar penduduknya adalah orang-orang yang sombong. Tidak banyak orang yang miskin di desa itu. Mereka akan diusir atau dibuat tidak nyaman kalau tinggal di sana. Hal ini mengusik hati anak kecil ini. Pada sebuah pesta yang diselenggarakan di kampung itu, anak kecil ini berhasil masuk. Namun, orang-orang segera mengusirnya dan mencaci-makinya. Ia langsung diseret keluar. Pada saat terseret, ia berpesan kepada orang-orang itu supaya lebih memerhatikan orang tak punya. Mendengar kata-kata anak itu, beberapa orang makin marah, bahkan meludahinya sambil berkata, “Dasar anak setan, anak buruk rupa!” Anak itu merasa terluka dengan perlakuan orang-orang tersebut. Lalu, ia menancapkan sebuah lidi di tanah don berkata, “Tak ada satu pun yang bisa mencabut lidi ini dari tanah, hanya aku yang bisa melakukannya!” Orang-orang meragukan ucapan anak tersebut. Mereka pun mencoba mencabut lidi tersebut. Namun, tak seorangpun dapat melakukannya. Dalam beberapa hari, lidi itu tak bisa tercabut. Suatu hari, secara diam-diam, anak itu datang dan mencabut lidi itu. Tanpa sepengetahuannya, ada seorang warga yang melihatnya dan melaporkannya kepada warga yang lain. Dari tempat lidi itu dicabut, mengalirlah mata air. Semakin lama, air itu semakin deras. Air menenggelamkan daerah tersebut, sehingga menjadi sebuah telaga yang kini bernama Telaga Rawa Pening. Tidak ada yang selamat dari musibah itu kecuali seorang perempuan tua yang berbaik hati memberinya tempat tinggal dan merawatnya. Secara ajaib penyakit kulit anak itu sembuh. Namun, penyihir jahat yang telah menyihir si anak itu tidak terima dengan kesembuhan itu. Kemudian, ia menyihir anak itu menjadi seekor ular besar dengan sebuah kalung genta di lehernya. Konon, ular ini sering keluar dari sarangnya pada tengah malam. Setiap kali bergerak, dentingan kalung di lehernya selalu berbunyi klentang-klenting. Bunyi inilah yang kemudian membuatnya dinamakan Baru Klinting. Kemunculan ular itu diyakinin masyarakat sebagai tando keberuntungan bagi nelayan nelayan yang tidak mendapat ikan. Kini, Telaga Rama Pening adalah objek wisata yang sangat populer di Jawa Tengah. Tempat ini terletak di Desa Bukit Cinta, Kabupaten Ambarawa.`,
                theme: "Kebaikan dan ketabahan dalam menghadapi kejahatan.",
                amanat: "Pentingnya menghargai orang lain, termasuk mereka yang tidak sempurna atau berbeda.",
                intrinsik: ["Tokoh", "Latar Tempat", "Watak", "Alur", "Latar Suasana", "Latar Waktu"]
            }
        };

        const quizQuestions = [
            // Pilihan Ganda 1
            {
                question: `Bacalah kutipan cerita berikut! “Rudi berlari mengejar bus yang mulai berjalan. Ia tak ingin terlambat sekolah. Keringat membasahi dahinya.” Unsur intrinsik yang paling menonjol dari kutipan tersebut adalah...`,
                options: ["A. Latar tempat", "B. Tokoh dan penokohan", "C. Tema", "D. Sudut pandang"],
                answer: "B. Tokoh dan penokohan"
            },
            {
                question: `Apa yang dimaksud dengan tema dalam sebuah cerita?`,
                options: ["A. Masalah utama yang dihadapi tokoh", "B. Waktu dan tempat kejadian", "C. Amanat yang disampaikan penulis", "D. Pokok pikiran atau gagasan utama cerita"],
                answer: "D. Pokok pikiran atau gagasan utama cerita"
            },
            {
                question: `Bacalah kutipan cerita! "Di sebuah desa kecil yang sepi, tinggal seorang petani tua yang rajin. Setiap pagi ia ke sawah dengan membawa cangkul dan semangat." Latar waktu dalam cerita tersebut adalah...`,
                options: ["A. Pagi hari", "B. Di desa kecil", "C. Di sawah", "D. Saat musim panen"],
                answer: "A. Pagi hari"
            },
            {
                question: `Mengapa tokoh dalam cerita disebut sebagai unsur intrinsik?`,
                options: ["A. Karena tokoh membantu penulis membuat cerita", "B. Karena tokoh menggambarkan pengarang", "C. Karena tokoh berperan dalam membangun alur cerita", "D. Karena tokoh menentukan latar cerita"],
                answer: "C. Karena tokoh berperan dalam membangun alur cerita"
            },
            {
                question: `Amanat dalam cerita berfungsi untuk...`,
                options: ["A. Membuat cerita menjadi lucu", "B. Menyampaikan pesan atau pelajaran", "C. Menjelaskan karakter tokoh", "D. Menentukan konflik"],
                answer: "B. Menyampaikan pesan atau pelajaran"
            },
            // Pilihan Ganda 2
            {
                question: `Bacalah cuplikan berikut! “Lani merasa sedih karena boneka kesayangannya hilang. Ia mencarinya ke seluruh rumah, tapi tak ketemu.” Apa sifat tokoh yang tergambar dari kutipan di atas?`,
                options: ["A. Ceroboh dan manja", "B. Peduli dan penyayang", "C. Suka bermain", "D. Pemarah dan keras kepala"],
                answer: "B. Peduli dan penyayang"
            },
            {
                question: `Sudut pandang orang pertama ditandai dengan penggunaan kata...`,
                options: ["A. Dia, mereka", "B. Saya, aku", "C. Nama tokoh", "D. Kami, mereka"],
                answer: "B. Saya, aku"
            },
            {
                question: `Di mana peristiwa dalam cerita berikut terjadi? "Suatu hari, setelah pulang sekolah, Dina dan teman-temannya bermain di taman kota. Mereka bermain kelereng dan bernyanyi bersama."`,
                options: ["A. Sekolah", "B. Rumah", "C. Taman Kota", "D. Pasar"],
                answer: "C. Taman Kota"
            },
            {
                question: `Apa yang membedakan tokoh protagonis dengan antagonis?`,
                options: ["A. Protagonis selalu lucu, antagonis selalu serius", "B. Protagonis bersifat baik, antagonis bersifat jahat", "C. Protagonis tidak penting, antagonis tokoh utama", "D. Protagonis hanya muncul di awal cerita"],
                answer: "B. Protagonis bersifat baik, antagonis bersifat jahat"
            },
            {
                question: `Mengapa memahami unsur intrinsik penting saat membaca cerita?`,
                options: ["A. Agar kita tahu siapa pengarangnya", "B. Supaya bisa menghafal cerita", "C. Untuk memahami isi dan makna cerita secara utuh", "D. Agar tahu berapa halaman cerita"],
                answer: "C. Untuk memahami isi dan makna cerita secara utuh"
            },
            // Pilihan Ganda 3
            {
                question: `Setelah membaca cerita "Si Kancil dan Buaya", menurutmu apakah amanat cerita tersebut sesuai dengan perilaku tokoh utama?`,
                options: ["A. Tidak sesuai karena Kancil menipu buaya", "B. Sesuai karena Kancil menggunakan kecerdikan untuk menyelamatkan diri", "C. Tidak sesuai karena buaya tidak salah", "D. Sesuai karena semua tokoh saling membantu"],
                answer: "B. Sesuai karena Kancil menggunakan kecerdikan untuk menyelamatkan diri"
            },
            {
                question: `Cerita "Malin Kundang" menyampaikan pesan tentang durhaka kepada orang tua. Menurutmu, bagaimana seharusnya penulis mengakhiri cerita agar pembaca tetap mendapat pelajaran tanpa adanya kutukan?`,
                options: ["A. Malin dibiarkan hidup bahagia", "B. Malin diberi kesempatan untuk memperbaiki kesalahannya", "C. Ibunya dihukum karena tidak memaafkan", "D. Cerita diakhiri tanpa pesan moral"],
                answer: "B. Malin diberi kesempatan untuk memperbaiki kesalahannya"
            },
            {
                question: `Jika kamu menjadi guru, apakah kamu akan merekomendasikan cerita "Timun Mas" kepada siswa untuk belajar tentang keberanian? Mengapa?`,
                options: ["A. Tidak, karena terlalu banyak tokoh jahat", "B. Ya, karena Timun Mas menunjukkan keberanian menghadapi raksasa", "C. Tidak, karena ceritanya sulit dimengerti", "D. Ya, karena ceritanya lucu dan menghibur"],
                answer: "B. Ya, karena Timun Mas menunjukkan keberanian menghadapi raksasa"
            },
            {
                question: `Perhatikan tokoh berikut! Lina adalah anak yang pemarah, tidak mau mengalah, dan suka menyalahkan orang lain. Jika kamu menjadi pembaca, bagaimana penilaianmu terhadap tokoh Lina?`,
                options: ["A. Tokoh yang baik dan sabar", "B. Tokoh yang jahat dan tidak punya teman", "C. Tokoh yang memiliki sifat yang harus dihindari", "D. Tokoh yang lucu dan berani"],
                answer: "C. Tokoh yang memiliki sifat yang harus dihindari"
            },
            {
                question: `Cerita “Ande-Ande Lumut” memiliki banyak tokoh wanita yang ingin menjadi istri pangeran. Jika kamu mengevaluasi isi ceritanya, pesan moral utama yang bisa diambil adalah...`,
                options: ["A. Penampilan lebih penting dari perilaku", "B. Menjadi sombong akan membawa keberuntungan", "C. Ketulusan dan kejujuran lebih berharga dari kecantikan", "D. Menipu adalah cara untuk menang"],
                answer: "C. Ketulusan dan kejujuran lebih berharga dari kecantikan"
            },
            // Pilihan Ganda 4
            {
                question: `Buatlah akhir cerita dari kisah berikut: “Danu menemukan seekor kucing kecil yang terluka di tepi jalan. Ia membawanya pulang.”`,
                options: ["A. Danu menelantarkan kucing itu", "B. Danu merawat kucing itu hingga sembuh dan menjadi sahabat", "C. Danu membuang kucing itu ke sungai", "D. Danu menjual kucing itu untuk uang"],
                answer: "B. Danu merawat kucing itu hingga sembuh dan menjadi sahabat"
            },
            {
                question: `Jika kamu menulis ulang cerita “Bawang Merah dan Bawang Putih” dengan sudut pandang Bawang Merah, apa yang bisa kamu ubah agar ceritanya menjadi lebih seimbang?`,
                options: ["A. Menunjukkan bahwa Bawang Merah juga punya alasan bersikap jahat", "B. Menjadikan Bawang Merah lebih jahat", "C. Menghilangkan tokoh Bawang Putih", "D. Membuat Bawang Merah menjadi tokoh utama yang disukai"],
                answer: "A. Menunjukkan bahwa Bawang Merah juga punya alasan bersikap jahat"
            },
            {
                question: `Buat tokoh utama yang bisa menggantikan peran “Si Kancil” dalam cerita rakyat, dengan karakter yang serupa.`,
                options: ["A. Seekor harimau yang kuat", "B. Seekor kura-kura yang sabar dan cerdik", "C. Seekor kerbau yang pemarah", "D. Seekor ular yang licik"],
                answer: "B. Seekor kura-kura yang sabar dan cerdik"
            },
            {
                question: `Jika kamu membuat cerita dengan latar “hutan ajaib di malam hari”, kejadian apa yang paling cocok dimasukkan agar cerita menarik?`,
                options: ["A. Tokoh tersesat dan bertemu makhluk ajaib yang memberinya nasihat", "B. Tokoh tidur sepanjang malam", "C. Tokoh bermain gadget di hutan", "D. Tokoh langsung keluar dari hutan tanpa masalah"],
                answer: "A. Tokoh tersesat dan bertemu makhluk ajaib yang memberinya nasihat"
            },
            {
                question: `Buatlah amanat yang cocok untuk cerita tentang seorang anak yang menolong hewan terluka.`,
                options: ["A. Jangan bermain di luar saat hujan", "B. Hewan harus dijauhi karena berbahaya", "C. Menolong makhluk hidup adalah perbuatan baik", "D. Jangan percaya pada orang asing"],
                answer: "C. Menolong makhluk hidup adalah perbuatan baik"
            }
        ];

        // Global state variables
        let currentScreen = 'start-screen';
        let currentMateriIndex = 0; // For navigating through materi (if needed, currently not used as it directly shows detail)
        let currentQuizQuestionIndex = 0;
        let quizScore = 0;
        let isSoundOn = true;

        // Get DOM elements
        const appContent = document.getElementById('app-content');
        const appHeader = document.getElementById('app-header');
        const appTitle = document.getElementById('app-title');
        const homeButton = document.getElementById('home-button');
        const soundButton = document.getElementById('sound-button');
        const soundIconPath = document.getElementById('sound-icon-path');
        const exitButton = document.getElementById('exit-button');

        const startScreen = document.getElementById('start-screen');
        const startAppButton = document.getElementById('start-app-button');

        const menuScreen = document.getElementById('menu-screen');
        const btnPetunjuk = document.getElementById('btn-petunjuk');
        const btnCpTp = document.getElementById('btn-cp-tp');
        const btnMateri = document.getElementById('btn-materi');
        const btnLatihan = document.getElementById('btn-latihan');
        const btnProfil = document.getElementById('btn-profil');

        const petunjukScreen = document.getElementById('petunjuk-screen');
        const petunjukBackButton = document.getElementById('petunjuk-back-button');
        const petunjukNextButton = document.getElementById('petunjuk-next-button');

        const cpTpScreen = document.getElementById('cp-tp-screen');
        const cpTpBackButton = document.getElementById('cp-tp-back-button');
        const cpTpNextButton = document.getElementById('cp-tp-next-button');

        const materiScreen = document.getElementById('materi-screen');
        const materiStoryButtons = materiScreen.querySelectorAll('.materi-item .button');
        const materiBackButton = document.getElementById('materi-back-button');
        const materiNextButton = document.getElementById('materi-next-button');

        const materiDetailScreen = document.getElementById('materi-detail-screen');
        const materiDetailTitle = document.getElementById('materi-detail-title');
        const storyText = document.getElementById('story-text');
        const storyTheme = document.getElementById('story-theme');
        const storyAmanat = document.getElementById('story-amanat');
        const storyIntrinsik = document.getElementById('story-intrinsik');
        const materiDetailBackButton = document.getElementById('materi-detail-back-button');
        const materiDetailNextButton = document.getElementById('materi-detail-next-button');

        const latihanScreen = document.getElementById('latihan-screen');
        const questionText = document.getElementById('question-text');
        const optionsContainer = document.getElementById('options-container');
        const feedbackMessage = document.getElementById('feedback-message');
        const latihanBackButton = document.getElementById('latihan-back-button');
        const latihanNextButton = document.getElementById('latihan-next-button');
        const scoreScreen = document.getElementById('score-screen');
        const finalScore = document.getElementById('final-score');
        const totalQuestions = document.getElementById('total-questions');
        const retakeQuizButton = document.getElementById('retake-quiz-button');
        const backToMenuFromQuizButton = document.getElementById('back-to-menu-from-quiz-button');

        const profilScreen = document.getElementById('profil-screen');
        const profilBackButton = document.getElementById('profil-back-button');
        const profilNextButton = document.getElementById('profil-next-button');

        const exitScreen = document.getElementById('exit-screen');
        const restartAppButton = document.getElementById('restart-app-button');

        // Custom Modal elements
        const customModal = document.getElementById('custom-modal');
        const modalTitle = document.getElementById('modal-title');
        const modalMessage = document.getElementById('modal-message');
        const modalConfirmBtn = document.getElementById('modal-confirm-btn');
        const modalCancelBtn = document.getElementById('modal-cancel-btn');

        // Function to show custom modal
        function showModal(title, message, isConfirm = false, onConfirm = null, onCancel = null) {
            modalTitle.textContent = title;
            modalMessage.textContent = message;
            customModal.classList.add('active');

            if (isConfirm) {
                modalCancelBtn.classList.remove('hidden');
                modalConfirmBtn.textContent = 'Ya';
                modalConfirmBtn.onclick = () => {
                    customModal.classList.remove('active');
                    if (onConfirm) onConfirm();
                };
                modalCancelBtn.onclick = () => {
                    customModal.classList.remove('active');
                    if (onCancel) onCancel();
                };
            } else {
                modalCancelBtn.classList.add('hidden');
                modalConfirmBtn.textContent = 'OK';
                modalConfirmBtn.onclick = () => {
                    customModal.classList.remove('active');
                    if (onConfirm) onConfirm(); // Use onConfirm for simple OK action
                };
            }
        }

        // Function to switch screens
        function showScreen(screenId) {
            const screens = document.querySelectorAll('.screen');
            screens.forEach(screen => screen.classList.add('hidden')); // Hide all screens
            document.getElementById(screenId).classList.remove('hidden'); // Show the target screen
            currentScreen = screenId;

            // Hide header for start and exit screens
            if (screenId === 'start-screen' || screenId === 'exit-screen') {
                appHeader.classList.add('hidden');
            } else {
                appHeader.classList.remove('hidden');
            }

            // Adjust header title based on screen
            switch (screenId) {
                case 'start-screen':
                case 'exit-screen':
                    appTitle.textContent = ''; // No title for these screens
                    break;
                case 'menu-screen':
                    appTitle.textContent = 'Cerita Rakyat Jawa Tengah';
                    break;
                case 'petunjuk-screen':
                    appTitle.textContent = 'Petunjuk';
                    break;
                case 'cp-tp-screen':
                    appTitle.textContent = 'CP Dan TP';
                    break;
                case 'materi-screen':
                    appTitle.textContent = 'Materi';
                    break;
                case 'materi-detail-screen':
                    // Title set by loadMateriDetail
                    break;
                case 'latihan-screen':
                    appTitle.textContent = 'Latihan Soal';
                    break;
                case 'profil-screen':
                    appTitle.textContent = 'Profil';
                    break;
            }
        }

        // --- Navigation Functions ---
        function goToMenu() {
            showScreen('menu-screen');
            const audio = document.getElementById('background-audio');
            if (isSoundOn) {
                audio.play(); // Play audio if sound is on
            }
        }

        function goToNextScreen() {
            // This function is for the forward arrow in general navigation
            switch (currentScreen) {
                case 'petunjuk-screen':
                    goToMenu(); // Petunjuk goes back to menu
                    break;
                case 'cp-tp-screen':
                    goToMenu(); // CP & TP goes back to menu
                    break;
                case 'materi-screen':
                    goToMenu(); // Materi selection goes back to menu
                    break;
                case 'materi-detail-screen':
                    goToMenu(); // Materi detail goes back to menu
                    break;
                case 'profil-screen':
                    showScreen('exit-screen'); // Profil goes to exit
                    break;
                case 'latihan-screen':
                    // Handled internally by quiz logic
                    break;
            }
        }

        function goToPreviousScreen() {
            // This function is for the backward arrow in general navigation
            switch (currentScreen) {
                case 'petunjuk-screen':
                case 'cp-tp-screen':
                case 'materi-screen':
                case 'materi-detail-screen':
                case 'latihan-screen':
                case 'profil-screen':
                    goToMenu();
                    break;
            }
        }

        // --- Sound Control ---
        function toggleSound() {
            isSoundOn = !isSoundOn;
            const audio = document.getElementById('background-audio');
            if (isSoundOn) {
                audio.play(); // Play audio if sound is on
                soundIconPath.setAttribute('d', 'M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z');
            } else {
                audio.pause(); // Pause audio if sound is off
                soundIconPath.setAttribute('d', 'M16.5 12c0-1.77-1.02-3.29-2.5-4.03v2.21l2.45 2.45c.03-.2.05-.41.05-.63zm2.5 0c0 .9-.23 1.73-.65 2.47l1.46 1.46C20.17 15.3 20.5 13.7 20.5 12c0-4.42-3.58-8-8-8-1.57 0-3.04.46-4.29 1.24l1.46 1.46c.9-.57 1.98-.92 3.09-.92 3.09 0 5.61 2.34 5.95 5.34zm-7.92 7.92l-1.46-1.46C8.73 17.27 7.9 17 7 17c-3.09 0-5.61-2.34-5.95-5.34l-1.92-1.92C.99 10.7 0 12 0 12c0 4.42 3.58 8 8 8 1.57 0 3.04-.46 4.29-1.24zM4.27 4.27L2 6.54l4.66 4.66H3v6h4l5 5V12.9l4.66 4.66 1.46-1.46L19.46 16l-2.03-2.03L22 17.27 19.73 19.5 12 11.77 4.27 4.27z');
            }
            showModal('Kontrol Suara', `Suara ${isSoundOn ? 'diaktifkan' : 'dinonaktifkan'}.`);
        }

        // --- Latihan Soal Logic ---
        function loadQuizQuestion() {
            if (currentQuizQuestionIndex < quizQuestions.length) {
                const question = quizQuestions[currentQuizQuestionIndex];
                questionText.textContent = `${currentQuizQuestionIndex + 1}. ${question.question}`;
                optionsContainer.innerHTML = ''; // Clear previous options
                feedbackMessage.classList.add('hidden'); // Hide feedback

                question.options.forEach((option, index) => {
                    const button = document.createElement('button');
                    button.classList.add('option-button');
                    button.textContent = option;
                    button.onclick = () => selectAnswer(option, question.answer, button);
                    optionsContainer.appendChild(button);
                });

                // Enable/disable navigation buttons for quiz
                latihanBackButton.style.visibility = (currentQuizQuestionIndex > 0) ? 'visible' : 'hidden';
                latihanNextButton.style.visibility = 'hidden'; // Next is only visible after answering
                scoreScreen.classList.add('hidden'); // Hide score screen while answering questions

            } else {
                // Quiz finished
                displayQuizScore();
            }
        }

        function selectAnswer(selectedOption, correctAnswer, clickedButton) {
            // Disable all options after selection
            Array.from(optionsContainer.children).forEach(button => {
                button.disabled = true;
                if (button.textContent === correctAnswer) {
                    button.classList.add('correct');
                } else if (button.textContent === selectedOption) {
                    button.classList.add('incorrect');
                }
            });

            if (selectedOption === correctAnswer) {
                quizScore++;
                feedbackMessage.textContent = 'Jawaban Anda benar!';
                feedbackMessage.style.color = '#28a745'; // Green
            } else {
                feedbackMessage.textContent = `Jawaban Anda salah. Jawaban yang benar adalah: ${correctAnswer}`;
                feedbackMessage.style.color = '#dc3545'; // Red
            }
            feedbackMessage.classList.remove('hidden');

            // Show next button after answering
            latihanNextButton.style.visibility = 'visible';
        }

        function displayQuizScore() {
            questionText.textContent = ''; // Clear question
            optionsContainer.innerHTML = ''; // Clear options
            feedbackMessage.classList.add('hidden'); // Hide feedback
            latihanBackButton.style.visibility = 'hidden'; // Hide nav buttons
            latihanNextButton.style.visibility = 'hidden'; // Hide nav buttons

            finalScore.textContent = quizScore;
            totalQuestions.textContent = quizQuestions.length;
            scoreScreen.classList.remove('hidden');
        }

        function resetQuiz() {
            currentQuizQuestionIndex = 0;
            quizScore = 0;
            loadQuizQuestion();
        }

        // --- Event Listeners ---
        window.onload = () => {
            showScreen('start-screen');
        };

        startAppButton.addEventListener('click', () => {
            goToMenu();
        });

        homeButton.addEventListener('click', () => {
            showModal('Konfirmasi', 'Apakah Anda ingin kembali ke Menu Utama?', true, goToMenu);
        });

        soundButton.addEventListener('click', toggleSound);

        exitButton.addEventListener('click', () => {
            showModal('Konfirmasi Keluar', 'Apakah Anda yakin ingin keluar dari aplikasi?', true, () => {
                showScreen('exit-screen');
            });
        });

        restartAppButton.addEventListener('click', () => {
            showScreen('start-screen');
            resetQuiz(); // Reset quiz state when restarting app
        });

        // Menu Buttons
        btnPetunjuk.addEventListener('click', () => showScreen('petunjuk-screen'));
        btnCpTp.addEventListener('click', () => showScreen('cp-tp-screen'));
        btnMateri.addEventListener('click', () => showScreen('materi-screen'));
        btnLatihan.addEventListener('click', () => {
            resetQuiz(); // Reset quiz when entering latihan screen
            showScreen('latihan-screen');
        });
        btnProfil.addEventListener('click', () => showScreen('profil-screen'));

        // General Navigation Buttons (Back/Next)
        petunjukBackButton.addEventListener('click', goToPreviousScreen);
        petunjukNextButton.addEventListener('click', goToNextScreen);
        cpTpBackButton.addEventListener('click', goToPreviousScreen);
        cpTpNextButton.addEventListener('click', goToNextScreen);
        materiBackButton.addEventListener('click', goToPreviousScreen);
        materiNextButton.addEventListener('click', goToNextScreen);
        materiDetailBackButton.addEventListener('click', () => showScreen('materi-screen')); // Back from detail to materi list
        materiDetailNextButton.addEventListener('click', goToNextScreen);
        profilBackButton.addEventListener('click', goToPreviousScreen);
        profilNextButton.addEventListener('click', goToNextScreen);

        // Latihan Navigation
        latihanBackButton.addEventListener('click', () => {
            if (currentQuizQuestionIndex > 0) {
                currentQuizQuestionIndex--;
                loadQuizQuestion();
            } else {
                goToPreviousScreen(); // Go to menu if at first question
            }
        });
        latihanNextButton.addEventListener('click', () => {
            currentQuizQuestionIndex++;
            loadQuizQuestion();
        });
        retakeQuizButton.addEventListener('click', resetQuiz);
        backToMenuFromQuizButton.addEventListener('click', goToMenu);


        // Materi Selection Buttons
        materiStoryButtons.forEach(button => {
            button.addEventListener('click', (event) => {
                const storyKey = event.target.dataset.story;
                const story = stories[storyKey];
                if (story) {
                    materiDetailTitle.textContent = story.title;
                    storyText.innerHTML = `<p>${story.text.replace(/\n/g, '</p><p>')}</p>`; // Preserve paragraphs
                    storyTheme.textContent = story.theme;
                    storyAmanat.textContent = story.amanat;

                    storyIntrinsik.innerHTML = '';
                    story.intrinsik.forEach(item => {
                        const li = document.createElement('li');
                        li.textContent = item;
                        storyIntrinsik.appendChild(li);
                    });
                    appTitle.textContent = story.title; // Update header title
                    showScreen('materi-detail-screen');
                } else {
                    showModal('Error', 'Materi tidak ditemukan.');
                }
            });
        });

        // Initialize quiz when latihan screen is shown
        // This is handled by the btnLatihan click event now.
        // If the screen is already latihan, and we need to reload, call loadQuizQuestion() directly.
        document.addEventListener('DOMContentLoaded', () => {
            // Initial load of the quiz if the screen is latihan-screen
            if (currentScreen === 'latihan-screen') {
                loadQuizQuestion();
            }
        });

    </script>
</body>
</html>
